<!DOCTYPE html>
<html>
    <head>
        <title>Red - Discord Bot Dashboard</title>
        <link rel="shortcut icon" type="image/png" href="https://i.imgur.com/uJGZl4O.png"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <style>
            body {
                margin: 0;
                font-family: sans-serif;
            }
            h1, p {
                padding-right: 10px;
                padding-left: 10px;
            }
            #message {
                border: 2px solid black;
                margin-right: 10px;
                margin-left: 10px;
            }
        </style>
    </head>
    <body>
        {% include 'includes/navbar.html' %}
        <div class="main">
            <div class="jumbotron">
                <h1 class="display-4">Sign in required.</h1>
                <p class="lead">Login information is required for that page.  Please sign in below in order to access it.</p>
                <hr class="my-4">
                <p>Login is performed via Discord OAuth, in order to make sure all permissions are respected.</p>
                <a class="btn btn-primary btn-lg" href="https://discordapp.com/api/oauth2/authorize?client_id={{ id }}&redirect_uri={{ redirect }}&response_type=code&scope=identify" role="button">Login</a>
            </div>
        </div>
        <script src="http://code.jquery.com/jquery-2.1.0.js"></script>
        <script>
            $("#button").click(function (event) {
                var xhr = new XMLHttpRequest();
                var url = "/login/action";
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState !== 4) { return }
                    /*
                    if (xhr.status === 409) {
                        console.log("409")
                        return
                    }
                    */
                    var json = JSON.parse(xhr.responseText);
                    $("#response").text("Response: " + json.response)
                    if (json.response == "Logged in") {
                        setTimeout(function() {
                            location.replace("/dashboard")
                        }, 500)
                    }
                };
                var data = JSON.stringify({"pass": $("#pass").val()});
                try {
                    xhr.send(data);
                } catch(error) {
                    //console.log(error)
                }
            })
            $(document).ready(function(){
                $('#pass').keypress(function(e) {
                    if(e.keyCode==13) {
                        $('#button').click();
                    }
                });
            });
        </script>
        <script>
            /* Open when someone clicks on the span element */
            function openNav() {
                document.getElementById("myNav").style.width = "15%";
            }

            /* Close when someone clicks on the "x" symbol inside the overlay */
            function closeNav() {
                document.getElementById("myNav").style.width = "0%";
            }
        </script>
    </body>
</html>